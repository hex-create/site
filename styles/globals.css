@tailwind base;
@tailwind components;
@tailwind utilities;

html,
body {
  @apply bg-gray-50 dark:bg-zinc-950;
  @apply text-neutral-800 dark:text-silver;
  @apply antialiased;
  @apply text-base;

  @apply selection:bg-indigo-500 selection:text-white dark:selection:bg-indigo-900;
  text-rendering: optimizeLegibility;
  font-feature-settings:
    "kern" on,
    "liga" on,
    "cv05" on,
    "cv10" on;
  font-variation-settings: "opsz" 15;
}

p {
  @apply mb-6;
  @apply last-of-type:mb-0;
  @apply leading-relaxed;
}

a[href^="mailto:"] {
  @apply cursor-alias;
}

[cmdk-overlay] {
  @apply bg-neutral-900/[.20];
  @apply dark:bg-black/[.70];
  @apply fixed left-0 top-0;
  @apply h-full w-full;
  @apply z-20;
  @apply backdrop-blur-sm backdrop-saturate-150;
}

[cmdk-dialog] {
  @apply max-w-md;
  @apply w-full;
  @apply fixed left-1/2 top-[20%];
  @apply flex items-start justify-center;
  @apply -translate-x-1/2;
  @apply z-20;
  @apply px-4;
}

[cmdk-root] {
  @apply relative;
  @apply bg-white/[.98];
  @apply dark:bg-neutral-900/[.98];
  @apply border-transparent;
  @apply dark:border-neutral-800;
  @apply border;
  @apply rounded-xl;
  @apply backdrop-blur-lg;
  @apply w-full;
  @apply shadow-fancy;
  @apply dark:shadow-dark;
}

[cmdk-input] {
  @apply appearance-none;
  @apply text-neutral-800 dark:text-silver;
  @apply placeholder:text-neutral-400 dark:placeholder:text-neutral-600;
  @apply bg-transparent;
  @apply w-full;
  @apply px-5 py-3 pb-0;
  /* @apply border-b dark:border-neutral-800; */
  @apply outline-none;
  @apply text-lg;
}

[cmdk-list] {
  @apply px-2 py-2;
  @apply transition-all;
  height: calc(var(--cmdk-list-height) + 16px);
}

[cmdk-item] {
  @apply px-3;
  @apply flex items-center gap-2;
  @apply px-3 py-2;
  @apply rounded-md;
  @apply cursor-pointer;
  @apply text-neutral-600 dark:text-silver-dark;
  @apply transition-colors;
  @apply [font-variation-settings:'wght'_420];
}

[cmdk-item][aria-selected] {
  @apply bg-neutral-100 dark:bg-neutral-800;
  @apply text-neutral-800 dark:text-silver;
}

[cmdk-item]:active {
  @apply bg-neutral-200/[.9] dark:bg-neutral-700;
  @apply text-neutral-800 dark:text-silver;
}

[cmdk-empty] {
  @apply px-3 py-3;
  @apply text-sm font-medium text-neutral-600 [font-variation-settings:'opsz'_12] dark:text-silver-dark;
}

[cmdk-separator] {
  @apply border-b dark:border-neutral-800;
  @apply my-2;
}

[cmdk-group-heading] {
  @apply px-3 py-2;
  @apply text-xs font-medium text-neutral-600 [font-variation-settings:'opsz'_12] dark:text-silver-dark;
}

[cmdk-loading] {
  @apply absolute;
  @apply top-3;
  @apply right-3;
  @apply text-neutral-400 dark:text-neutral-600;
  @apply animate-fadeIn;
}

[cmdk-loading] div {
  @apply flex;
}

/* Animations */

.island-enter {
  @apply scale-50 opacity-[.01];
}

.island-enter.island-enter-active {
  @apply scale-100 opacity-100;
  @apply transition-all duration-500 ease-spring;
}

.island-leave {
  @apply scale-100 opacity-100;
}

.island-leave.island-leave-active {
  @apply scale-50 opacity-[.01];
  @apply transition-all duration-300 ease-in-out;
}

.tooltip-enter {
  @apply -translate-y-1 opacity-[.01];
}

.tooltip-enter.tooltip-enter-active {
  @apply translate-y-0 opacity-100;
  @apply transition-all duration-200 ease-in-out;
}

.tooltip-leave {
  @apply translate-y-0 opacity-100;
}

.tooltip-leave.tooltip-leave-active {
  @apply -translate-y-1 opacity-[.01];
  @apply transition-all duration-200 ease-in-out;
}

.pin-city {
  @apply border-fuchsia-500/10;
  @apply bg-fuchsia-500/60;
}

.pin-place {
  @apply border-purple-500/10;
  @apply bg-purple-500/60;
}

.pin-airport {
  @apply border-rose-500/10;
  @apply bg-rose-500/60;
}

.pin-country {
  @apply border-green-500/10;
  @apply bg-green-500/60;
}

.pin-neighborhood {
  @apply border-orange-500/10;
  @apply bg-orange-500/60;
}

.pin-hotel {
  @apply border-yellow-400/10;
  @apply bg-yellow-400/60;
}

.pin-park {
  @apply border-emerald-500/10;
  @apply bg-emerald-500/60;
}

.mapboxgl-popup-tip,
.mapboxgl-popup-close-button {
  @apply hidden;
}

.mapboxgl-popup-content {
  @apply rounded border border-transparent bg-neutral-800 px-3 py-3 font-sans text-base font-medium text-silver [font-variation-settings:'opsz'_15,_'wght'_500] dark:border-white/[.08] dark:bg-black/[.96] dark:text-silver !important;
}

@layer components {
  .studio-list-title {
    @apply col-span-12 sm:col-span-8 flex items-start pl-0 sm:pl-0;
  }
  .studio-list-content {
    @apply col-span-12 sm:col-span-4 flex flex-col justify-start;
  }
  .studio-screenshot-placeholder {
    @apply w-full aspect-[16/9] bg-gray-300 dark:bg-zinc-800;
    min-height: 120px;
    /* No border, no rounding, no max-width, no centering */
  }

  .link {
    @apply !underline;
    @apply !decoration-1.5;
    @apply !underline-offset-2.5;
    @apply !decoration-neutral-300 dark:!decoration-neutral-700;
    @apply hover:!decoration-neutral-400 dark:hover:!decoration-neutral-600;
    @apply motion-safe:transition;
    @apply duration-150;
    @apply ease-out-expo;
    text-decoration-skip-ink: all;
  }

  .note {
    @apply font-serif;
    @apply [font-variation-settings:'opsz'_7,_'wght'_360];
    @apply text-base-adjusted-sm;
    @apply leading-relaxed;
    @apply p-4;
    @apply bg-neutral-950;
    @apply border border-solid border-neutral-850;
    @apply rounded-xl;
    @apply tracking-zero;
    @apply w-full;
    @apply flex flex-col gap-1;
  }

  .note-block {
    @apply font-sans;
    @apply leading-relaxed;
    @apply p-4;
    @apply bg-neutral-950;
    @apply border border-solid border-neutral-850;
    @apply rounded-xl;
    @apply w-full;
  }

  .note-block > div > p:first-child {
    @apply mt-0;
  }

  .note-block > div > p:last-child {
    @apply mb-0;
  }

  .note b,
  .note strong {
    @apply [font-variation-settings:'opsz'_7,_'wght'_500];
  }

  .note .time,
  .list-content .time {
    @apply pt-1;
  }

  .sidebar {
    @apply font-sans;
    @apply block;
    @apply text-sm;
    @apply text-neutral-500 dark:text-silver-dark;
    @apply [font-variation-settings:'opsz'_14];
    @apply slashed-zero tabular-nums;
    @apply mb-6
  }

  .toc {
    @apply mt-0;
    @apply p-0;
  }

  .time {
    @apply font-sans;
    @apply block;
    @apply text-sm;
    @apply text-neutral-500 dark:text-silver-dark;
    @apply [font-variation-settings:'opsz'_14];
    @apply slashed-zero tabular-nums;
  }

  .time-lg {
    @apply text-base;
    @apply [font-variation-settings:'opsz'_15];
  }

  .badge {
    @apply flex items-center gap-1 rounded-xl bg-gray-200 px-1.5 py-0.5 text-xs font-medium text-neutral-600 [font-variation-settings:'opsz'_12] dark:bg-neutral-900 dark:text-silver-dark;
    @apply slashed-zero;
    @apply decoration-neutral-600;
    @apply inline;
  }

  .list-container {
    @apply mb-12 grid grid-cols-12 gap-8 gap-y-2 sm:mb-16 sm:gap-y-4;
    @apply border-t border-solid border-neutral-500/10 pt-4 dark:border-neutral-900;
  }

  .list-container:last-of-type {
    @apply mb-0;
  }

  .list-title {
    @apply col-span-12 sm:col-span-4;
  }

  .list-content {
    @apply col-span-12 sm:col-span-8;
  }

  .list-content-wide {
    @apply col-span-12 sm:col-span-12;
  }

  .list-sticky {
    @apply sticky top-4;
  }

  /* Post layout with overflow sidebars */
  .post-layout {
    @apply relative;
    @apply border-t border-solid border-neutral-500/10 pt-4 dark:border-neutral-900;
    @apply mb-12 sm:mb-16;
  }

  .post-content {
    @apply w-full;
  }

  .post-sidebar-left,
  .post-sidebar-right {
    @apply hidden;
  }

  /* TOC item styles */
  .toc-item {
    @apply -mx-2 px-2 py-0.5 rounded;
    @apply transition-colors duration-150;
  }

  .toc-active {
    @apply bg-neutral-800 text-white;
  }

  /* Show sidebars on xl screens (1280px+) */
  @media (min-width: 1280px) {
    .post-sidebar-left {
      @apply block fixed;
      top: 12rem;
      width: 13rem;
      /* Position to the left of the main content area */
      right: calc(50% + 23rem + 2rem);
    }

    .post-sidebar-right {
      @apply block absolute;
      top: 1rem;
      width: 13rem;
      left: calc(100% + 2rem);
    }
  }

  /* Wider sidebars on 2xl screens (1536px+) */
  @media (min-width: 1536px) {
    .post-sidebar-left {
      width: 14rem;
      right: calc(50% + 23rem + 3rem);
    }

    .post-sidebar-right {
      width: 14rem;
      left: calc(100% + 3rem);
    }
  }

  .island {
    @apply bg-white/95;
    @apply dark:bg-neutral-900/95;
    @apply border-transparent;
    @apply dark:border-white/[.1];
    @apply backdrop-blur-md;
    @apply border;
    @apply dark:shadow-xl;
    @apply shadow-fancy;
    @apply h-12 w-12;
    @apply rounded-full;
    @apply inline-flex items-center justify-center;
    @apply hover:scale-110;
    @apply active:scale-90;
    @apply transition-all;
  }

  .prose-custom {
    max-width: 100ch !important;
    @apply prose-a:link;
    @apply prose-a:[font-variation-settings:'opsz'_15,_'wght'_450];
    @apply prose-p:first:mt-0;
    @apply prose-p:leading-relaxed sm:prose-p:leading-golden;
    @apply prose prose-neutral dark:prose-invert;
    @apply prose-p:text-neutral-800 dark:prose-p:text-silver;
    @apply prose-headings:font-normal prose-headings:[font-variation-settings:'wght'_500];
    @apply prose-strong:font-normal prose-strong:[font-variation-settings:'wght'_500];
    @apply prose-em:not-italic prose-em:underline prose-em:decoration-neutral-300 prose-em:decoration-wavy dark:prose-em:decoration-neutral-700;
    @apply prose-code:rounded prose-code:font-normal prose-code:text-neutral-300 dark:prose-code:text-neutral-300 prose-code:px-1 prose-code:py-1 prose-code:bg-gray-700;
    @apply prose-pre:overflow-auto prose-pre:whitespace-pre prose-pre:border prose-pre:border-neutral-200 prose-pre:bg-transparent prose-pre:p-4 prose-pre:text-sm dark:prose-pre:border-neutral-900 sm:prose-pre:-ml-4 sm:prose-pre:-mr-4;
    @apply prose-img:rounded-lg;
    @apply prose-hr:my-6 prose-hr:h-[2px] prose-hr:border-none prose-hr:bg-neutral-200 dark:prose-hr:bg-neutral-900 sm:prose-hr:my-10;
    @apply prose-blockquote:not-italic prose-blockquote:text-neutral-600 dark:prose-blockquote:text-silver-dark;
    @apply prose-th:text-left prose-th:[font-variation-settings:'wght'_500];
    @apply prose-td:text-left;
    @apply prose-td:first:font-medium prose-td:first:[font-variation-settings:'wght'_500];
  }
}

@layer utilities {
  .link-external,
  .link-back {
    @apply inline-flex;
    @apply max-w-none;
    @apply items-center;
    @apply gap-0.5;
  }

  .link-share {
    @apply inline-flex;
    @apply items-center;
    @apply gap-1;
    @apply text-sm;
    @apply px-2 py-1.5;
    @apply rounded-lg bg-gray-200 text-neutral-700 transition-colors [font-variation-settings:'opsz'_14,'wght'_400] hover:bg-gray-300 dark:bg-neutral-900 dark:text-silver-dark dark:hover:bg-neutral-800;
  }

  .link-external svg {
    @apply decoration-transparent;
    @apply text-neutral-400 dark:text-silver-dark;
  }

  .link-back:hover svg {
    @apply -translate-x-0.5;
  }

  .link-back svg {
    @apply decoration-transparent;
    @apply -ml-6;
    @apply mr-1;
    @apply mb-0.5;
    @apply text-silver-dark;
    @apply motion-safe:transition;
    @apply duration-150;
    @apply ease-out-expo;
  }

  .link-sm {
    @apply text-xs;
    @apply decoration-1.5;
    @apply underline-offset-1.5;
    @apply text-neutral-500 dark:text-silver-dark;
    @apply decoration-neutral-300 dark:decoration-neutral-700;
    @apply hover:decoration-neutral-400 dark:hover:decoration-neutral-600;
    @apply [font-variation-settings:'opsz'_12];
  }

  .link-fade {
    @apply text-sm;
    @apply text-neutral-500 dark:text-silver-dark;
    @apply hover:text-neutral-800 dark:hover:text-silver;
    @apply transition-colors;
  }

  .text-shadow {
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
  }

  .mask-gradient {
    mask-image: linear-gradient(to top, transparent 0%, rgba(0, 0, 0, 1) 90%);
  }
}

/* Text Diagram Styles */
.text-diagram-container {
  /* Enable smooth horizontal scrolling on touch devices */
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.15) transparent;
  /* Hide scrollbar by default, show on hover */
  scrollbar-width: none;
}

.text-diagram-container:hover {
  scrollbar-width: thin;
}

.text-diagram-container::-webkit-scrollbar {
  height: 6px;
  display: none;
}

.text-diagram-container:hover::-webkit-scrollbar {
  display: block;
}

.text-diagram-container::-webkit-scrollbar-track {
  background: transparent;
}

.text-diagram-container::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 3px;
}

.text-diagram-container::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.25);
}

/* Canvas-like drag behavior */
.text-diagram-container.cursor-grab {
  cursor: grab;
}

.text-diagram-container.cursor-grabbing {
  cursor: grabbing;
}

.text-diagram-content {
  /* Responsive font sizing */
  font-size: 0.75rem;
  line-height: 1.4;
  /* Override prose styling that adds borders to pre elements */
  border: none !important;
  margin: 0 !important;
  background: transparent !important;
}

@media (min-width: 640px) {
  .text-diagram-content {
    font-size: 0.8125rem;
    line-height: 1.45;
  }
}

@media (min-width: 768px) {
  .text-diagram-content {
    font-size: 0.875rem;
    line-height: 1.5;
  }
}

@media (min-width: 1024px) {
  .text-diagram-content {
    font-size: 0.9rem;
  }
}

.mapboxgl-control-container {
  display: none !important;
}

/* Liveblocks Comments Styles - Using @liveblocks/react-ui */
/* Note: Base styles imported in _app.tsx to avoid duplication */

/* Hide Liveblocks branding */
[data-liveblocks-portal] a[href*="liveblocks.io"] {
  display: none !important;
}

/* Liveblocks theme customization */
.lb-root {
  --lb-accent: rgb(37 99 235);
  --lb-accent-foreground: rgb(255 255 255);
  --lb-radius: 0.5rem;
}

/* Dark mode (via .dark class from component) */
.dark .lb-root {
  --lb-accent: rgb(96 165 250);
  --lb-accent-foreground: rgb(15 23 42);
  --lb-background: rgb(9 9 11);
  --lb-foreground: rgb(229 231 235);
  --lb-dynamic-background: rgb(23 23 23);
  --lb-dynamic-foreground: rgb(212 212 212);
}

/* Hide attachment, emoji, and mention buttons in composer */
.lb-composer-editor-action[aria-label="Add emoji"],
.lb-composer-editor-action[aria-label="Attach files"],
.lb-composer-editor-action[aria-label="Mention someone"],
.lb-composer-mention-button,
.lb-lexical-mention-button {
  display: none !important;
}

/* Hide three-dot menu button and emoji picker on comments */
.lb-comment-action[aria-label="More"],
.lb-comment-action[aria-label="Add reaction"] {
  display: none !important;
}

/* Hide "Powered by Liveblocks" badge */
#liveblocks-badge {
  display: none !important;
}

/* Always show send button and keep composer footer stable */
.lb-composer-submit,
.lb-composer-action,
.lb-composer-action[disabled] {
  display: flex !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Keep button disabled functionally but always visible */
.lb-composer-action[disabled] {
  pointer-events: none !important;
  cursor: not-allowed !important;
}

/* Prevent composer footer from resizing when blurred */
.lb-composer-footer {
  min-height: auto !important;
  height: auto !important;
}

/* Keep composer editor actions visible */
.lb-composer-editor-actions {
  opacity: 1 !important;
  visibility: visible !important;
}

/* Remove padding from inline thread highlights to prevent text shifting */
[data-lb-inline-thread] {
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* SpeedReader Overlay Styles */
.speedreader-overlay {
  @apply fixed inset-0 z-50;
  @apply bg-white dark:bg-neutral-950;
  @apply flex flex-col items-center justify-center;
  font-variation-settings: "opsz" 48, "wght" 500;
}

.speedreader-word-container {
  @apply relative;
  @apply text-5xl sm:text-7xl md:text-8xl;
  @apply text-neutral-900 dark:text-white;
  font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  width: 100%;
  height: 1.2em;
}

.speedreader-before {
  @apply absolute;
  right: calc(50% + 0.5ch);
  text-align: right;
}

.speedreader-orp {
  @apply absolute;
  left: 50%;
  transform: translateX(-50%);
  @apply text-red-500 dark:text-red-400;
}

.speedreader-after {
  @apply absolute;
  left: calc(50% + 0.5ch);
  text-align: left;
}

.speedreader-progress {
  @apply absolute top-6 right-6;
  @apply text-sm text-neutral-400 dark:text-neutral-600;
  @apply [font-variation-settings:'opsz'_14];
  @apply slashed-zero tabular-nums;
}

.speedreader-wpm {
  @apply absolute top-6 left-6;
  @apply text-sm text-neutral-400 dark:text-neutral-600;
  @apply [font-variation-settings:'opsz'_14];
  @apply slashed-zero tabular-nums;
}

.speedreader-legend {
  @apply absolute bottom-6 left-1/2 -translate-x-1/2;
  @apply flex gap-6;
  @apply text-xs text-neutral-400 dark:text-neutral-600;
  @apply [font-variation-settings:'opsz'_12];
}